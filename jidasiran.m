U=[1.147 0.201 -0.787 -1.584 -1.052 0.866 1.152 1.573 0.626...
   0.433 -0.958 0.810 -0.044 0.947 -1.474 -0.719 -0.086 1.099...
   1.450 1.151 0.485 1.633 0.043 1.326 1.706 -0.340 0.890...
   0.433 -1.177 -0.390 -0.982 1.435 -0.119 -0.769 -0.899 0.882...
   -1.008 -0.844 0.628 -0.679 1.541 1.375 -0.984 -0.582 1.609...
   0.090 -0.813 -0.428 -0.848 -0.410 0.048 -1.099 -1.108 0.259...
   -1.627 -0.528 0.203 1.204 1.691 -1.235 -1.228 -1.267 0.309...
   0.043 0.043 1.461 1.585 0.552 -0.601 -0.319 0.744 0.829...
   -1.626 -0.127 -1.578 -0.822 1.469 -0.379 -0.212 0.178 0.493...
   -0.056 -0.1294 1.228 -1.606 -0.382 -0.229 0.313 -0.161 -0.810...
   -0.277 0.983 -0.288 0.846 1.325 0.723 0.713 0.643 0.463...
   0.786 1.161 0.850 -1.349 -0.596 1.512 0.795 -0.713 0.453...
   -1.604 0.889 -0.938 0.056 0.829 -0.981 -1.232 1.327 -0.681...
   0.114 -1.135 1.284 -1.201 0.758 0.590 -1.007 0.390 0.836...
   -1.52 -1.053 -0.083 0.619 0.840 -1.258 -0.354 0.629 -0.242...
   1.680 -1.236 -0.803 0.537 -1.100 1.417 -1.024 0.671 0.688...
   -0.123 -0.952 0.232 -0.793 -1.138 1.154 0.206 1.196 1.013...
   1.518 -0.553 -0.987 0.167 -1.445 0.630 1.255 0.311 -1.726...
   0.975 1.718 1.360 1.667 1.111 1.018 0.078 -1.665 -0.760...
   1.184 -0.614 0.994 -0.089 0.947 1.706 -0.395 1.222 -1.351...
   0.231 1.425 0.114 -0.689 -0.704 1.070 0.262 1.610 1.489...
   -1.602 0.020 -0.601 -0.020 -0.601 -0.235 1.245 1.226 -0.204...
   0.926 -1.297] %输入数据

Y=[0.086 2.210 0.486 -1.812 -3.705 -2.688 1.577 2.883 3.705...
   1.642 0.805 -2.088 0.946 -0.039 1.984 -2.545 -1.727 -0.231...
   2.440 3.583 2.915 1.443 3.598 0.702 2.638 3.611 -0.168...
   1.732 0.666 2.377 -0.554 -2.088 2.698 0.189 -1.633 -2.010...
   1.716 -1.641 -1.885 1.061 -0.968 2.911 3.088 -1.629 -1.533...
   3.030 0.614 -1.483 -1.029 -1.948 -1.066 -0.113 -2.144 -2.626...
   0.134 -3.043 -1.341 0.338 2.702 3.813 -1.924 -2.813 -1.795...
   3.002 1.027 1.027 2.755 3.584 1.737 -0.837 -0.617 1.703...
   2.045 -2.886 -0.542 -2.991 -1.859 3.045 0.068 -0.375 0.451... 
   1.036 0.153 -0.474 2.512 -2.681 -0.954 -0.307 0.628 -0.270...
   -0.277 0.983 -0.288 0.846 1.325 0.723 1.750 1.401 1.340...
   0.916 1.396 2.446 2.103 2.432 -1.486 3.031 2.373 -0.763...
   -0.752 -3.207 1.385 -1.642 -0.118 1.756 -1.613 -1.690 2.136... 
   -1.136 -0.005 -2.210 2.331 -2.204 0.983 1.347 -1.691 0.595...
   1.809 -2.204 -2.330 -0.454 1.290 2.080 -1.990 -0.770 1.240...
   -0.252 3.137 -2.379 1.206 1.221 -1.977 2.471 -1.680 1.148...
   1.816 0.055 -1.856 0.269 -1.323 -2.486 1.958 0.823 2.481...
   2.209 3.167 -0.762 -2.225 -0.123 -2.786 1.026 2.843 1.071...
   -3.317 1.514 3.807 3.388 3.683 -1.935 -1.935 0.309 -3.390...
   -2.124 2.192 -0.855 -1.656 0.016 1.804 3.774 -0.059 2.371...
   -2.322 -0.032 2.632 0.565 -1.460 -1.839 1.917 0.865 3.180...
   3.261 -2.755 -0.536 -1.171 -0.905 -3.303 -0.834 2.490 3.039...
   0.134 1.901]%输出数据

na=2;nb=1;nc=2;d=1;
nn=max(na,nc);
L=size(Y,2);
xiek=zeros(nc,1); %白噪声估计初值
yfk=zeros(nn,1); %yf(k-i)
ufk=zeros(nn,1); %uf(k-i)
xiefk=zeros(nc,1); %vf(k-i)
thetae_1=zeros(na+nb+1+nc,1); %参数估计初值
P=eye(na+nb+1+nc);
for k=3:L
    %构造向量
    phi=[-Y(k-1);-Y(k-2);U(k-1);U(k-2);xiek]; %组建h（k）
    xie=Y(k)-phi'*thetae_1;
    phif=[-yfk(1:na);ufk(d:d+nb);xiefk];
    
    %递推极大似然参数估计算法
    K=P*phif/(1+phif'*P*phif);
    thetae(:,k)=thetae_1+K*xie;
    P=(eye(na+nb+1+nc)-K*phif')*P;    
        
    yf=Y(k)-thetae(na+nb+2:na+nb+1+nc,k)'*yfk(1:nc); %yf(k)
    uf=U(k)-thetae(na+nb+2:na+nb+1+nc,k)'*ufk(1:nc); %uf(k)
    xief=xie-thetae(na+nb+2:na+nb+1+nc,k)'*xiefk(1:nc); %vf(k)
      
    %更新数据
    thetae_1=thetae(:,k);
    for i=nc:-1:2
        xiek(i)=xiek(i-1);
        xiefk(i)=xiefk(i-1);
    end
    xiek(1)=xie;
    xiefk(1)=xief;
    
    for i=nn:-1:2
        yfk(i)=yfk(i-1);
        ufk(i)=ufk(i-1);
    end
    yfk(1)=yf;
    ufk(1)=uf;
end
thetae_1
figure(1)
plot([1:L],thetae(1:na,:));
xlabel('k'); ylabel('参数估计a');
legend('a_1','a_2'); axis([0 L -2 2]);
figure(2)
plot([1:L],thetae(na+1:na+nb+1,:));
xlabel('k'); ylabel('参数估计b');
legend('b_1','b_2'); axis([0 L -1.5 2]);
figure(3)
plot([1:L],thetae(na+nb+2:na+nb+nc+1,:));
xlabel('k'); ylabel('参数估计c');
legend('c_1','c_2'); axis([0 L -2 2]);
